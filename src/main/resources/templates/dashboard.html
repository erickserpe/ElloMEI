<!DOCTYPE html>
<html lang="pt-br" xmlns:th="http://www.thymeleaf.org"
      th:replace="~{layout :: layout-base(~{::title}, ~{::div})}">
<head>
    <title>Dashboard - SCF MEI</title>
</head>
<body>
<div>
    <h1 class="mb-4">Painel de Controle</h1>

    <div class="row">
        <div class="col-md-4">
            <div class="card text-white bg-success mb-3">
                <div class="card-header">SALDO TOTAL</div>
                <div class="card-body">
                    <h5 class="card-title" th:text="${'R$ ' + #numbers.formatDecimal(saldoTotal, 1, 'POINT', 2, 'COMMA')}">R$ 0,00</h5>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card text-white bg-info mb-3">
                <div class="card-header">ENTRADAS NO MÊS</div>
                <div class="card-body">
                    <h5 class="card-title" th:text="${'R$ ' + #numbers.formatDecimal(totalEntradas, 1, 'POINT', 2, 'COMMA')}">R$ 0,00</h5>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card text-dark bg-warning mb-3">
                <div class="card-header">SAÍDAS NO MÊS</div>
                <div class="card-body">
                    <h5 class="card-title" th:text="${'R$ ' + #numbers.formatDecimal(totalSaidas, 1, 'POINT', 2, 'COMMA')}">R$ 0,00</h5>
                </div>
            </div>
        </div>
    </div>

    <div class="row mt-4">
        <div class="col-md-6">
            <div class="card">
                <div class="card-body">
                    <h5 class="card-title">Despesas por Categoria (Mês Atual)</h5>
                    <canvas id="despesasPorCategoriaChart"></canvas>
                </div>
            </div>
        </div>
    </div>


    <script th:src="@{/webjars/chartjs/4.4.3/dist/chart.umd.js}"></script>
    <script>
        // Executa o script depois que a página carregar
        document.addEventListener('DOMContentLoaded', function() {
            // 1. Busca os dados no nosso endpoint da API
            fetch('/api/dashboard/despesas-por-categoria')
                .then(response => response.json())
                .then(data => {
                    // 2. Prepara os dados para o formato que o Chart.js entende
                    const labels = data.map(item => item.label);
                    const values = data.map(item => item.value);

                    // 3. Pega o elemento <canvas> do HTML
                    const ctx = document.getElementById('despesasPorCategoriaChart');

                    // 4. Cria o novo gráfico
                    new Chart(ctx, {
                        type: 'doughnut', // Tipo do gráfico (pizza/rosca)
                        data: {
                            labels: labels,
                            datasets: [{
                                label: 'Total Gasto',
                                data: values,
                                backgroundColor: [ // Cores para cada fatia
                                    '#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0', '#9966FF', '#FF9F40'
                                ]
                            }]
                        },
                        options: {
                            responsive: true,
                            plugins: {
                                legend: {
                                    position: 'top',
                                }
                            }
                        }
                    });
                });
        });
    </script>
</div>
</body>
</html>