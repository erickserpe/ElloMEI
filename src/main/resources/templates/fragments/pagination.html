<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Pagination Fragment</title>
</head>
<body>

<!-- Fragmento de Paginação Reutilizável -->
<div th:fragment="pagination(page)" th:if="${page != null && page.totalPages > 1}" class="d-flex justify-content-between align-items-center mt-4">
    
    <!-- Informações da página -->
    <div class="text-muted">
        <small>
            Mostrando 
            <strong th:text="${page.numberOfElements}">0</strong> 
            de 
            <strong th:text="${page.totalElements}">0</strong> 
            registros
            (Página <strong th:text="${page.number + 1}">1</strong> de <strong th:text="${page.totalPages}">1</strong>)
        </small>
    </div>
    
    <!-- Controles de paginação -->
    <nav aria-label="Navegação de páginas">
        <ul class="pagination mb-0">
            <!-- Primeira página -->
            <li class="page-item" th:classappend="${page.first} ? 'disabled'">
                <a class="page-link" 
                   th:href="@{${#httpServletRequest.requestURI}(page=0, size=${page.size}, ${#httpServletRequest.queryString != null ? #strings.replace(#strings.replace(#httpServletRequest.queryString, 'page=' + page.number, ''), 'size=' + page.size, '') : ''})}"
                   aria-label="Primeira">
                    <span aria-hidden="true">&laquo;&laquo;</span>
                </a>
            </li>
            
            <!-- Página anterior -->
            <li class="page-item" th:classappend="${!page.hasPrevious()} ? 'disabled'">
                <a class="page-link" 
                   th:href="@{${#httpServletRequest.requestURI}(page=${page.number - 1}, size=${page.size})}"
                   aria-label="Anterior">
                    <span aria-hidden="true">&laquo;</span>
                </a>
            </li>
            
            <!-- Números de página (mostra até 5 páginas) -->
            <th:block th:each="i : ${#numbers.sequence(
                T(java.lang.Math).max(0, page.number - 2), 
                T(java.lang.Math).min(page.totalPages - 1, page.number + 2)
            )}">
                <li class="page-item" th:classappend="${i == page.number} ? 'active'">
                    <a class="page-link" 
                       th:href="@{${#httpServletRequest.requestURI}(page=${i}, size=${page.size})}"
                       th:text="${i + 1}">1</a>
                </li>
            </th:block>
            
            <!-- Próxima página -->
            <li class="page-item" th:classappend="${!page.hasNext()} ? 'disabled'">
                <a class="page-link" 
                   th:href="@{${#httpServletRequest.requestURI}(page=${page.number + 1}, size=${page.size})}"
                   aria-label="Próxima">
                    <span aria-hidden="true">&raquo;</span>
                </a>
            </li>
            
            <!-- Última página -->
            <li class="page-item" th:classappend="${page.last} ? 'disabled'">
                <a class="page-link" 
                   th:href="@{${#httpServletRequest.requestURI}(page=${page.totalPages - 1}, size=${page.size})}"
                   aria-label="Última">
                    <span aria-hidden="true">&raquo;&raquo;</span>
                </a>
            </li>
        </ul>
    </nav>
    
    <!-- Seletor de tamanho de página -->
    <div class="d-flex align-items-center">
        <small class="text-muted me-2">Itens por página:</small>
        <select class="form-select form-select-sm" style="width: auto;" onchange="window.location.href = updateQueryStringParameter(window.location.href, 'size', this.value)">
            <option value="10" th:selected="${page.size == 10}">10</option>
            <option value="20" th:selected="${page.size == 20}">20</option>
            <option value="50" th:selected="${page.size == 50}">50</option>
            <option value="100" th:selected="${page.size == 100}">100</option>
        </select>
    </div>
</div>

<!-- Script para atualizar query string -->
<script th:fragment="pagination-script">
    function updateQueryStringParameter(uri, key, value) {
        var re = new RegExp("([?&])" + key + "=.*?(&|$)", "i");
        var separator = uri.indexOf('?') !== -1 ? "&" : "?";
        if (uri.match(re)) {
            return uri.replace(re, '$1' + key + "=" + value + '$2');
        } else {
            return uri + separator + key + "=" + value;
        }
    }
</script>

</body>
</html>

